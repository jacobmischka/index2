<div class="{{ `directory ${hidden ? 'hidden' : ''}` }}">
	<button type="button"
			class="{{ expanded ? 'contract' : 'expand' }}"
			on:click="set({expanded: !expanded})">
		{{ expanded ? 'Collapse' : 'Expand' }}
	</button>

	<div class="details">
		<Node type="directory"
			name="{{ name }}"
			size="{{ size }}"
			path="{{ path }}"
			lastModified="{{ lastModified }}"
			displayPath="{{ displayPath }}" />

		{{#if expanded}}
			<div class="children">
				{{#each sortedChildren as child}}
					{{#if child.type === 'directory'}}
						<:Self
							name="{{ child.name }}"
							size="{{ child.size }}"
							path="{{ child.path }}"
							lastModified="{{ lastModified }}"
							hidden="{{ child.hidden }}" />
					{{else}}
						<File
							name="{{ child.name }}"
							size="{{ child.size }}"
							path="{{ child.path }}"
							lastModified="{{ lastModified }}"
							hidden="{{ child.hidden }}" />
					{{/if}}
				{{/each}}
			</div>
		{{/if}}
	</div>
</div>

<script>
import Node from './Node.html';
import File from './File.html';

import { getContents, sortNodes } from '../utils.js';

export default {
	data() {
		return {
			name: '',
			size: 0,
			path: '',
			lastModified: 'today',
			children: [],
			displayPath: false,

			expanded: false
		};
	},

	oncreate() {
		this.observe('expanded', expanded => {
			if (expanded) {
				const children = this.get('children');

				if (!children || !Array.isArray(children) || children.length === 0)
					this.getChildren();
			}
		});
	},

	computed: {
		sortedChildren(children) {
			if (children)
				return sortNodes(children);

			return [];
		}
	},

	methods: {
		getChildren() {
			getContents(this.get('path')).then(children => {
				this.set({children});
			}).catch(err => {
				console.error(err);
			});
		}
	},

	components: {
		Node,
		File
	}
};
</script>

<style>
	.directory {
		display: flex;
		flex-direction: row;
		align-items: flex-start;
	}

	.directory.hidden {
		display: none;
	}

	.details {
		flex-grow: 1;
	}

	.children {
		margin-left: 1em;
		padding-left: 1em;
		border-left: 2px solid #ECEFF1;
	}

	.directory > .details > .node:before {
		content: '';
		display: block;
		background: #777;
		transform: rotate(45deg);
	}

	.directory > .details > .node > .name > a {
		color: #37474F;
	}

	.directory > .details > .node > .name > a:hover {
		color: #78909C;
	}
</style>
